<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Predict | Bigg Boss 19</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="navbar">
  <a href="index.html">Home</a>
  <a href="predict.html">Predict</a>
  <a href="leaderboard.html">Leaderboard</a>
  <a href="contestants.html">Contestants</a>
  <a href="rules.html">Rules</a>
  <a href="admin.html" id="adminLink" style="display:none;">Admin</a>
</div>

<div class="center-screen">
  <h2>Make Your Prediction ðŸ”®</h2>
  <div id="countdown" style="font-size:1.5rem; margin:1rem;"></div>
  <div class="prediction-options" id="optionsContainer"></div>
  <button id="submitPrediction">Submit</button>
  <h3>Previous Predictions</h3>
  <div id="prevPredictions"></div>
</div>

<script>
const user = localStorage.getItem('twitch_user');
if(!user){ alert('Login required!'); window.location.href='index.html'; }
const adminList=['bobmasterbillie'];
if(user && adminList.includes(user)) document.getElementById('adminLink').style.display='inline-block';

const nominations = JSON.parse(localStorage.getItem('nominations')||'[]');
const predictionEnd = parseInt(localStorage.getItem('prediction_end')||0);
const predictionResult = localStorage.getItem('prediction_result');

const optionsContainer = document.getElementById('optionsContainer');
let selectedOption = null;
nominations.forEach(name=>{
  const card = document.createElement('div');
  card.classList.add('card');
  card.innerHTML=`<h3>${name}</h3>`;
  card.onclick = ()=>{ if(new Date().getTime()<predictionEnd){ selectedOption=name; document.querySelectorAll('.card').forEach(c=>c.classList.remove('selected')); card.classList.add('selected'); } };
  optionsContainer.appendChild(card);
});

document.getElementById('submitPrediction').onclick = ()=>{
  if(!selectedOption){ alert('Select an option!'); return; }
  if(new Date().getTime()>predictionEnd){ alert('Prediction ended!'); return; }
  const allPreds = JSON.parse(localStorage.getItem('predictions')||'[]');
  allPreds.push({user,option:selectedOption});
  localStorage.setItem('predictions', JSON.stringify(allPreds));
  alert('Prediction submitted!');
  renderPrev();
};

function renderPrev(){
  const container=document.getElementById('prevPredictions');
  container.innerHTML='';
  const preds=JSON.parse(localStorage.getItem('predictions')||'[]');
  preds.forEach(p=>{
    const div=document.createElement('div');
    div.textContent=`${p.user} â†’ ${p.option}${predictionResult? ' | Result: '+predictionResult : ''}`;
    container.appendChild(div);
  });
}
renderPrev();

// countdown
const countdownEl=document.getElementById('countdown');
setInterval(()=>{
  const diff=predictionEnd-new Date().getTime();
  if(diff>0){
    const mins=Math.floor(diff/60000); const sec=Math.floor((diff%60000)/1000);
    countdownEl.textContent=`Time left: ${mins}m ${sec}s`;
  }else countdownEl.textContent='Prediction ended!';
},1000);
</script>
</body>
</html>
