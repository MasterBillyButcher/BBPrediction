<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bigg Boss 19 | Predict</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="navbar">
  <a href="index.html">Home</a>
  <a href="predict.html">Predict</a>
  <a href="leaderboard.html">Leaderboard</a>
  <a href="contestants.html">Contestants</a>
  <a href="admin.html" id="adminLink" style="display:none;">Admin</a>
</div>

<section class="center-screen">
<h2>Make Your Prediction ðŸ”®</h2>
<div id="countdown" style="margin:10px 0;font-size:18px;"></div>

<div class="grid-container" id="predictGrid"></div>
<button id="confirmBtn">Confirm Prediction</button>

<h3>Previous Predictions</h3>
<div id="oldPredictions"></div>

<script>
let user={username:"MasterBillie"}; // Replace with actual Twitch OAuth
if(localStorage.getItem('currentPrediction')) document.getElementById('confirmBtn').disabled=false;

const adminUsers=["bobmasterbillie"];
if(adminUsers.includes(user.username.toLowerCase())) document.getElementById('adminLink').style.display='block';

const currentPrediction=JSON.parse(localStorage.getItem('currentPrediction')||'{}');
const nominations=currentPrediction.nominations||[];
const endTime=currentPrediction.endTime?new Date(currentPrediction.endTime):null;

const predictGrid=document.getElementById('predictGrid');
nominations.forEach(name=>{
  const div=document.createElement('div');
  div.classList.add('card');
  div.innerHTML=`<img src="Contestant/${name}.jpg" onerror="this.src='https://via.placeholder.com/200x250?text=${name}'"><h3>${name}</h3>`;
  div.onclick=()=>{
    predictGrid.querySelectorAll('.card').forEach(c=>c.classList.remove('selected'));
    div.classList.add('selected');
  };
  predictGrid.appendChild(div);
});

document.getElementById('confirmBtn').onclick=()=>{
  const selected=predictGrid.querySelector('.card.selected');
  if(!selected){alert('Select one contestant or option!'); return;}
  let saved=JSON.parse(localStorage.getItem('userPredictions')||'[]');
  saved.push({user:user.username,prediction:selected.querySelector('h3').innerText});
  localStorage.setItem('userPredictions',JSON.stringify(saved));
  alert('Prediction saved: '+selected.querySelector('h3').innerText);
};

// Countdown Timer
if(endTime){
  const countdownEl=document.getElementById('countdown');
  const timer=setInterval(()=>{
    const now=new Date();
    const diff=endTime-now;
    if(diff<=0){countdownEl.innerText='Prediction ended'; document.getElementById('confirmBtn').disabled=true; clearInterval(timer);}
    else{
      const h=Math.floor(diff/1000/3600);
      const m=Math.floor(diff/1000/60)%60;
      const s=Math.floor(diff/1000)%60;
      countdownEl.innerText=`Prediction ends in ${h}h ${m}m ${s}s`;
    }
  },1000);
}

// Show old predictions
const oldPreds=JSON.parse(localStorage.getItem('userPredictions')||'[]');
const oldDiv=document.getElementById('oldPredictions');
oldPreds.forEach(p=>{
  const div=document.createElement('div');
  div.innerText=`${p.user} â†’ ${p.prediction}`;
  oldDiv.appendChild(div);
});
</script>
</section>
</body>
</html>
