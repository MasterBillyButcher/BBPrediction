<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Twitch Callback</title>
</head>
<body>
<script>
const hash = window.location.hash.substring(1);
const params = new URLSearchParams(hash);
const access_token = params.get('access_token');

if(access_token){
  // Fetch Twitch username
  fetch('https://api.twitch.tv/helix/users', {
    headers: {
      'Authorization': 'Bearer ' + access_token,
      'Client-Id': 'wtecr95tk5eu66xeugoiph13ba69m9'
    }
  }).then(res=>res.json()).then(data=>{
    if(data.data && data.data.length>0){
      const username = data.data[0].display_name.toLowerCase();
      localStorage.setItem('twitch_user', username);
      window.location.href = 'rules.html';
    }
  });
}else{
  alert('Login failed!');
  window.location.href = 'index.html';
}
</script>
</body>
</html>
