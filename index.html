<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bigg Boss 19 | Home</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="navbar">
  <a href="index.html">Home</a>
  <a href="predict.html">Predict</a>
  <a href="leaderboard.html">Leaderboard</a>
  <a href="contestants.html">Contestants</a>
  <a href="admin.html" id="adminLink" style="display:none;">Admin</a>
</div>

<section class="home-screen">
  <h1>Welcome to Bigg Boss 19 Prediction Game</h1>
  <p>Predict the weekly nominations and earn points!</p>
  <ul>
    <li>Login with Twitch to participate.</li>
    <li>Select contestants or special options each week.</li>
    <li>Points are awarded for correct predictions.</li>
    <li>Leaderboard updates in real-time.</li>
    <li>Admins can nominate contestants, set end time, and publish results.</li>
  </ul>
  <div id="loginContainer">
    <button id="loginBtn" onclick="loginWithTwitch()">Login with Twitch</button>
    <img id="twitchAvatar" src="" style="width:50px;height:50px;border-radius:50%;display:none;">
    <span id="twitchUser"></span>
  </div>
</section>

<script>
const CLIENT_ID='wtecr95tk5eu66xeugoiph13ba69m9';
const adminNames=['bobmasterbillie'];

async function checkTwitchLogin(){
  const token=localStorage.getItem('twitch_token');
  if(token){
    try{
      const res = await fetch('https://api.twitch.tv/helix/users',{
        headers:{'Authorization':'Bearer '+token,'Client-Id': CLIENT_ID}
      });
      const data = await res.json();
      if(data.data && data.data.length>0){
        const user=data.data[0];
        document.getElementById('twitchUser').innerText=user.display_name;
        document.getElementById('twitchAvatar').src=user.profile_image_url;
        document.getElementById('twitchAvatar').style.display='inline-block';
        document.getElementById('loginBtn').style.display='none';
        if(adminNames.includes(user.display_name)) document.getElementById('adminLink').style.display='inline-block';
      }else{
        localStorage.removeItem('twitch_token');
      }
    }catch(err){console.error(err);localStorage.removeItem('twitch_token');}
  }
}

function loginWithTwitch(){
  const redirect = encodeURIComponent('https://bb-prediction.vercel.app/callback.html');
  window.location.href=`https://id.twitch.tv/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${redirect}&response_type=token&scope=user:read:email`;
}

checkTwitchLogin();
</script>
</body>
</html>
